<!-- 
    æ›´æ–°ğŸé¡µé¢
 -->


<template>
    <div id="Test">
        <div class="inputspcCard">
            <el-row>
                <el-col :span='8'>
                    <el-button v-model="myCardItem[0]" placeholder="æ”¯æ´å¡1"
                        @click="dialogVisibleSpc = true;potionSelector=0"><span
                            v-if="myCardItem[0]">{{myCardItem[0].name}}</span><span v-else>è¯·é€‰æ‹©æ”¯æ´å¡1</span></el-button>
                    <el-input-number v-model="myCardItemLV[0]" :min="1" :max="50" :step="5" controls-position="right">
                    </el-input-number>
                </el-col>
                <el-col :span='8'>
                    <el-button v-model="myCardItem[1]" placeholder="æ”¯æ´å¡2"
                        @click="dialogVisibleSpc = true;potionSelector=1"><span
                            v-if="myCardItem[1]">{{myCardItem[1].name}}</span><span v-else>è¯·é€‰æ‹©æ”¯æ´å¡2</span></el-button>
                    <el-input-number v-model="myCardItemLV[1]" :min="1" :max="50" :step="5" controls-position="right">
                    </el-input-number>
                </el-col>
                <el-col :span='8'>
                    <el-button v-model="myCardItem[2]" placeholder="æ”¯æ´å¡3"
                        @click="dialogVisibleSpc = true;potionSelector=2"><span
                            v-if="myCardItem[2]">{{myCardItem[2].name}}</span><span v-else>è¯·é€‰æ‹©æ”¯æ´å¡3</span></el-button>
                    <el-input-number v-model="myCardItemLV[2]" :min="1" :max="50" :step="5" controls-position="right">
                    </el-input-number>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span='8'>
                    <el-button v-model="myCardItem[3]" placeholder="æ”¯æ´å¡4"
                        @click="dialogVisibleSpc = true;potionSelector=3"><span
                            v-if="myCardItem[3]">{{myCardItem[3].name}}</span><span v-else>è¯·é€‰æ‹©æ”¯æ´å¡4</span></el-button>
                    <el-input-number v-model="myCardItemLV[3]" :min="1" :max="50" :step="5" controls-position="right">
                    </el-input-number>
                </el-col>
                <el-col :span='8'>
                    <el-button v-model="myCardItem[4]" placeholder="æ”¯æ´å¡5"
                        @click="dialogVisibleSpc = true;potionSelector=4"><span
                            v-if="myCardItem[4]">{{myCardItem[4].name}}</span><span v-else>è¯·é€‰æ‹©æ”¯æ´å¡5</span></el-button>
                    <el-input-number v-model="myCardItemLV[4]" :min="1" :max="50" :step="5" controls-position="right">
                    </el-input-number>
                </el-col>
                <el-col :span='8'>
                    <el-button v-model="myCardItem[5]" placeholder="æ”¯æ´å¡6"
                        @click="dialogVisibleSpc = true;potionSelector=5"><span
                            v-if="myCardItem[5]">{{myCardItem[5].name}}</span><span v-else>è¯·é€‰æ‹©æ”¯æ´å¡6</span></el-button>
                    <el-input-number v-model="myCardItemLV[5]" :min="1" :max="50" :step="5" controls-position="right">
                    </el-input-number>
                </el-col>
            </el-row>
        </div>
        <div class="inputUma">
            <el-row>
                <el-col :span='8'>
                    <el-tag>ã‚¹ãƒ“</el-tag>
                    <el-input-number v-model="myUmaStaus[0]" controls-position="right" :min="1" :max="1200" :step="100">
                    </el-input-number>
                    <el-tag>ã‚¹ã‚¿</el-tag>
                    <el-input-number v-model="myUmaStaus[1]" controls-position="right" :min="1" :max="1200" :step="100">
                    </el-input-number>
                </el-col>
                <el-col :span='8'>
                    <el-tag>ãƒ‘ãƒ¯ãƒ¼</el-tag>
                    <el-input-number v-model="myUmaStaus[2]" controls-position="right" :min="1" :max="1200" :step="100">
                    </el-input-number>
                    <el-tag>æ ¹æ€§</el-tag>
                    <el-input-number v-model="myUmaStaus[3]" controls-position="right" :min="1" :max="1200" :step="100">
                    </el-input-number>
                </el-col>
                <el-col :span='8'>
                    <el-tag>è³¢ã•</el-tag>
                    <el-input-number v-model="myUmaStaus[4]" controls-position="right" :min="1" :max="1200" :step="100">
                    </el-input-number>
                    <el-tag>ã‚¹ã‚³ã‚¢</el-tag>
                    <el-input-number v-model="myUmaStaus[5]" controls-position="right"></el-input-number>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="8">
                    <el-select v-model="myUmaItem" placeholder="ğŸå" filterable style="width: 60%">
                        <el-option v-for="item in umaItem" :key="item.id" :value="item.id" :label="item.name">
                        </el-option>
                    </el-select>
                </el-col>
                <!-- rank -->
                <el-col :span="8">
                    <el-buttonã€€@click="dialogVisibleTekisei=true">é©æ€§</el-button>
                    <el-buttonã€€@click="dialogVisibleSkill=true">ã‚¹ã‚­ãƒ«</el-button>
                </el-col>
                <el-col :span="8">
                    <el-checkbox v-model="notshowUser">åŒ¿åæäº¤</el-checkbox>
                    <el-button @click="insertUma2Sql" style="width:30%;margin-left:20px;" type="success"><span>æäº¤</span></el-button>
                </el-col>
            </el-row>
        </div>
        <el-dialog title="é€‚æ€§é€‰æ‹©" width="60%" class="umaconfig"  :visible.sync="dialogVisibleTekisei">
            <span>é¦¬å ´é©æ€§</span>  
            <el-tag>èŠ</el-tag>
            <el-select v-model="myUmaConfig.baba.shiba" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

            <el-tag>ãƒ€ãƒ¼ãƒˆ</el-tag>
            <el-select v-model="myUmaConfig.baba.dato" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

            <br>

            <span>è·é›¢é©æ€§</span>  
            <el-tag>çŸ­è·é›¢</el-tag>
            <el-select v-model="myUmaConfig.kyori.tankyori" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

            <el-tag>ãƒã‚¤ãƒ«</el-tag>
            <el-select v-model="myUmaConfig.kyori.mairu" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

            <el-tag>ä¸­è·é›¢</el-tag>
            <el-select v-model="myUmaConfig.kyori.juukyori" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

            <el-tag>é•·è·é›¢</el-tag>
            <el-select v-model="myUmaConfig.kyori.cyoukyori" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

            <br>

            <span>è„šè³ª</span>  
            <el-tag>é€ƒã’</el-tag>
            <el-select v-model="myUmaConfig.kyakushitu.nige" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

            <el-tag>å…ˆè¡Œ</el-tag>
            <el-select v-model="myUmaConfig.kyakushitu.senkou" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

            <el-tag>å·®ã—</el-tag>
            <el-select v-model="myUmaConfig.kyakushitu.sashi" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

            <el-tag>è¿½è¾¼</el-tag>
            <el-select v-model="myUmaConfig.kyakushitu.oikomi" size="mini">
                <el-option
                v-for="item in rankOption"
                :key="item"
                :value="item">
                </el-option>
            </el-select>

        </el-dialog>
        

        <el-dialog title="é€‰æ‹©æ”¯æ´å¡" :visible.sync="dialogVisibleSpc">
            <SelectWindow  v-on:getCardFromChild='reciveCardItem' />
        </el-dialog>

        <el-dialog title="é€‰æ‹©æŠ€èƒ½" :visible.sync="dialogVisibleSkill" fullscreen>
            <SelectSkill v-on:getSkillFromChild='reciveSkill'/>
        </el-dialog>
    </div>
</template>

<script>
    import {
        qurSql
    } from "../jsfile/api/con2sql.js"
    import {
        updatenewuma
    } from "../jsfile/api/insertUma.js"

    import SelectWindow from "@/components/child/SelectWindow.vue"
    import SelectSkill from "@/components/child/SelectSkill.vue"
    export default {
        name: 'RegisterNewUma',
        components: {
            SelectWindow,SelectSkill
        },
        data() {
            return {
                sqlcon: {
                    username: 'Guest',
                    userpasswd: 'password#123',
                    database: 'umamusume-pbl',
                },
                //cardItem: [],
                myCardItem: [], //å¡-æäº¤
                myCardItemLV: [30, 30, 30, 30, 30, 30], //ç­‰çº§-æäº¤
                dialogVisibleTekisei: false,
                dialogVisibleSpc: false,
                dialogVisibleSkill:false,
                potionSelector: '0',
                umaItem: [],
                myUmaItem: '', //ğŸ-æäº¤
                myUmaStaus: [0, 0, 0, 0, 0, 0], //æ•°å€¼-æäº¤

                // TODO: æ·»åŠ ğŸçš„é…ç½®, æ·»åŠ ğŸçš„æŠ€èƒ½
                myUmaConfig: {
                    baba:{
                        shiba:"A",
                        dato:"A"
                    },
                    kyori:{
                        tankyori:"A",
                        mairu:"A",
                        juukyori:"A",
                        cyoukyori:"A",
                    },
                    kyakushitu:{
                        nige:"A",
                        senkou:"A",
                        sashi:"A",
                        oikomi:"A"
                    }
                },
                rankOption:['S','A', 'B', 'C', 'D', 'E','F','G'],
                myUmaSkill:[],
                notshowUser:false
            }
        },
        mounted() {
            let query_uma = 'SELECT id, CONCAT(\'ã€\',uma_secname,\'ã€‘ï¼\',uma_name) AS `name` FROM uma'
            qurSql(this.sqlcon, query_uma, res => {
                this.umaItem = res
                console.log(res)
            })
        },
        methods: {
            reciveCardItem(data) {
                this.myCardItem[this.potionSelector] = data;
                this.dialogVisibleSpc = false
            },
            reciveSkill(data){
                this.myUmaSkill = data
                this.dialogVisibleSkill = false
            },
            async insertUma2Sql() {
                // console.log(this.notshowUser)
                if(!(this.notshowUser || !this.$store.state.user.uuid==null)){
                    this.$message.error('è¯·å…ˆç™»å½•')
                    return
                }
                var umaInsert = {
                    id_name: this.myUmaItem,
                    status: this.myUmaStaus,
                    cardItem: this.myCardItem,
                    cardItemLV: this.myCardItemLV,
                    moreinfo: this.myUmaConfig,
                    skill: this.myUmaSkill,
                    userUUID: this.showUser?this.$store.state.user.uuid:null,
                }
                let flag = true;
                if(this.myUmaItem == '' ){
                    this.$message.error('é©¬æ²¡é€‰')
                    flag=false
                }
                if(this.myUmaSkill.length == 0){
                    this.$message.error('æŠ€èƒ½æ²¡é€‰')
                    flag=false
                }
                if(this.myCardItem.length !=6){
                    this.$message.error('æ”¯æ´å¡æ²¡é€‰å…¨')
                    flag=false
                }else{
                    this.myCardItem.forEach((el)=>{
                        if(el==null){
                            flag=false
                            this.$message.error('æ”¯æ´å¡æ²¡é€‰å…¨')
                        }
                    })

                }
                
                if(!flag){
                    return
                }
                await updatenewuma(umaInsert)
                this.$message("æäº¤æˆåŠŸ")
            }
        },
    }
</script>

<style scoped>
    .el-row {
        margin: auto;
        padding: 5px 5px;
    }

    .el-input-number {
        width: 25%;
        margin: 5px 5px !important;

    }

    .el-dialog .el-tag{
        margin: 0.5vw
    }

    .el-dialog .el-select{
        width: 6vw
    }

    .umaconfig{
        text-align: left;
        
    }
</style>